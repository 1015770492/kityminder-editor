/*!
 * ====================================================
 * kityminder-editor - v1.0.21 - 2015-06-15
 * https://github.com/fex-team/kityminder-editor
 * GitHub: https://github.com/fex-team/kityminder-editor 
 * Copyright (c) 2015 ; Licensed 
 * ====================================================
 */

!function(){function a(a){b.r([c[a]])}var b={r:function(a){if(b[a].inited)return b[a].value;if("function"!=typeof b[a].value)return b[a].inited=!0,b[a].value;var c={exports:{}},d=b[a].value(null,c.exports,c);if(b[a].inited=!0,b[a].value=d,void 0!==d)return d;for(var e in c.exports)if(c.exports.hasOwnProperty(e))return b[a].inited=!0,b[a].value=c.exports,c.exports}};b[0]={value:function(a,c,d){function e(a){g.push(a)}function f(a){this.selector=a;for(var b=0;b<g.length;b++)"function"==typeof g[b]&&g[b].call(this,this)}var g=[];return f.assemble=e,e(b.r(5)),e(b.r(6)),e(b.r(11)),e(b.r(15)),e(b.r(8)),e(b.r(9)),e(b.r(12)),e(b.r(7)),e(b.r(10)),e(b.r(13)),e(b.r(14)),d.exports=f}},b[1]={value:function(a,c,d){return d.exports=kityminder.Editor=b.r(0)}},b[2]={value:function(a,b,c){return c.exports=window.HotBox}},b[3]={value:function(a,b,c){}},b[4]={value:function(a,b,c){return c.exports=window.kityminder.Minder}},b[5]={value:function(a,b,c){function d(){var a;if(a="string"==typeof this.selector?document.querySelector(this.selector):this.selector,!a)throw new Error("Invalid selector: "+this.selector);a.classList.add("km-editor"),this.container=a}return c.exports=d}},b[6]={value:function(a,c,d){function e(a,b,c,d){if(a.when!=b)return!1;if("*"!=a.enter&&a.enter!=d)return!1;if("*"==a.exit||a.exit==c)return!0}function f(a){var b=a,c=" - ",d=" -> ",f=[];this.jump=function(a,c){if(!c)throw new Error("Please tell fsm the reason to jump");var d,g,h=b,j=[h,a].concat([].slice.call(arguments,1));for(d=0;d<f.length;d++)if(g=f[d],e(g.condition,"before",h,a)&&g.apply(null,j))return;for(b=a,i.log("[{0}] {1} -> {2}",c,h,a),d=0;d<f.length;d++)g=f[d],e(g.condition,"after",h,a)&&g.apply(null,j);return b},this.state=function(){return b},this.when=function(a,b){1==arguments.length&&(b=a,a="* -> *");var e,g,h,i;if(g=a.split(c),2==g.length?e="before":(g=a.split(d),2==g.length&&(e="after")),!e)throw new Error("Illegal fsm condition: "+a);h=g[0],i=g[1],b.condition={when:e,exit:h,enter:i},f.push(b)}}function g(){this.fsm=new f("normal")}var h=b.r(16),i=new h("fsm");return d.exports=g}},b[7]={value:function(a,c,d){function e(){function a(){m=[],n=[],k=o.exportJson()}function b(){var a=o.exportJson(),b=f(a,k);if(b.length){for(m.push(b);m.length>q;)m.shift();return k=a,!0}}function c(){var a=o.exportJson();n.push(f(a,k)),k=a}function d(){l=!0;var a=m.pop();a&&(o.applyPatches(a),c()),l=!1}function e(){l=!0;var a=n.pop();n&&(o.applyPatches(a),b()),l=!1}function g(){l||b()&&(n=[])}function h(){return!!m.length}function i(){return!!n.length}function j(a){if(l){var b=a.patch;switch(b.express){case"node.add":o.select(b.node.getChild(b.index),!0);break;case"node.remove":case"data.replace":case"data.remove":case"data.add":o.select(b.node,!0)}}}var k,l,m,n,o=this.minder,p=this.hotbox,q=100;this.history={reset:a,undo:d,redo:e,hasUndo:h,hasRedo:i},a(),o.on("contentchange",g),o.on("import",a),o.on("patch",j);var r=p.state("main");r.button({position:"top",label:"撤销",key:"Ctrl + Z",enable:h,action:d,next:"idle"}),r.button({position:"top",label:"重做",key:"Ctrl + Y",enable:i,action:e,next:"idle"})}var f=b.r(19);return window.diff=f,d.exports=e}},b[8]={value:function(a,c,d){function e(){var a=this.fsm,b=this.minder,c=(this.receiver,this.container),d=new f(c);a.when("normal -> hotbox",function(a,c,e){var f,g=b.getSelectedNode();if(g){var h=g.getRenderBox();f={x:h.cx,y:h.cy}}d.active("main",f)}),a.when("normal -> normal",function(a,c,e,f){if("shortcut-handle"==e){var g=d.dispatch(f);g?f.preventDefault():b.dispatchKeyEvent(f)}}),this.hotbox=d}var f=b.r(2);return d.exports=e}},b[9]={value:function(a,c,d){function e(){function a(){j.when("* -> input",e),j.when("input -> *",function(a,b,c){switch(c){case"input-cancel":return h();case"input-commit":default:return f()}}),k.on("beforemousedown",function(){"input"==j.state()&&j.jump("normal","input-commit")}),k.on("dblclick",function(){k.getSelectedNode()&&d()})}function b(){g.flaged&&n.classList.add("debug"),n.onmousedown=function(a){a.stopPropagation()},k.on("layoutallfinish viewchange viewchanged selectionchange",function(a){("viewchange"!=a.type||"input"==j.state())&&i()}),i()}function c(){l.state("main").button({position:"center",label:"编辑",key:"F2",enable:function(){return-1!=k.queryCommandState("text")},action:d})}function d(){n.innerText=k.queryCommandValue("text"),j.jump("input","input-request"),m.selectAll()}function e(){var a=k.getSelectedNode();if(a){var b=a.getData("font-size")||a.getStyle("font-size");n.style.fontSize=b+"px",n.style.minWidth=0,n.style.minWidth=n.clientWidth+"px",n.classList.add("input"),n.focus()}}function f(){var a=n.innerText;k.execCommand("text",a.replace(/^\n*|\n*$/g,"")),h()}function h(){n.classList.remove("input"),m.selectAll()}function i(){var a=i,b=k.getSelectedNode();b&&(a.timer||(a.timer=setTimeout(function(){var c=b.getRenderBox("TextRenderer");n.style.left=Math.round(c.x)+"px",n.style.top=(g.flaged?Math.round(c.bottom+30):Math.round(c.y))+"px",a.timer=0})))}var j=this.fsm,k=this.minder,l=this.hotbox,m=this.receiver,n=m.element;b(),a(),c(),this.editText=d}b.r(18);var f=b.r(16),g=new f("input");return d.exports=e}},b[10]={value:function(a,c,d){function e(a){return a.ctrlKey||a.metaKey||a.altKey?!1:a.keyCode>=65&&a.keyCode<=90?!0:a.keyCode>=48&&a.keyCode<=57?!0:229==a.keyCode?!0:void 0}function f(){var a=this.fsm,b=this.minder,c=this.receiver,d=this.container,f=c.element,h=this.hotbox;c.listen("normal",function(c){if("keydown"==c.type&&c.is("Space"))return c.preventDefault(),a.jump("hotbox","space-trigger");if("keydown"==c.type&&e(c)){if(b.getSelectedNode())return a.jump("input","user-input");f.innerHTML=""}return"keydown"==c.type?a.jump("normal","shortcut-handle",c):void 0}),c.listen("hotbox",function(b){b.preventDefault();h.dispatch(b);return h.state()==g.STATE_IDLE&&"hotbox"==a.state()?a.jump("normal","hotbox-idle"):void 0}),c.listen("input",function(b){if("keydown"==b.type){if(b.is("Enter"))return b.preventDefault(),a.jump("normal","input-commit");if(b.is("Esc"))return b.preventDefault(),a.jump("normal","input-cancel");(b.is("Tab")||b.is("Shift + Tab"))&&b.preventDefault()}});var i,j,k=2;d.addEventListener("mousedown",function(b){b.button==k&&b.preventDefault(),"hotbox"==a.state()?(h.active(g.STATE_IDLE),a.jump("normal","blur")):"normal"==a.state()&&b.button==k&&(i=b.clientX,j=b.clientY)},!1),d.addEventListener("contextmenu",function(a){a.preventDefault()}),d.addEventListener("mouseup",function(c){"normal"==a.state()&&c.button==k&&c.clientX==i&&c.clientY==j&&b.getSelectedNode()&&a.jump("hotbox","content-menu")},!1),h.$element.addEventListener("mousedown",function(a){a.stopPropagation()})}var g=b.r(2);return d.exports=f}},b[11]={value:function(a,c,d){function e(){var a=new f({enableKeyReceiver:!1,enableAnimation:!1});a.renderTo(this.selector),a.setTheme(null),a.select(a.getRoot(),!0),a.execCommand("text","中心主题"),this.minder=a}var f=b.r(4);return d.exports=e}},b[12]={value:function(a,b,c){function d(){var a=this,b=this.minder,c=this.hotbox,d=this.fsm,e=c.state("main"),f=["前移:Alt+Up:ArrangeUp","下级:Tab:AppendChildNode","同级:Enter:AppendSiblingNode","后移:Alt+Down:ArrangeDown","删除:Delete|Backspace:RemoveNode","归纳:Shift+Tab|Shift+Insert:AppendParentNode"];f.forEach(function(c){var f=c.split(":"),g=f.shift(),h=f.shift(),i=f.shift();e.button({position:"ring",label:g,key:h,action:function(){0===i.indexOf("Append")?(b.execCommand(i,"新主题"),a.editText()):(b.execCommand(i),d.jump("normal","command-executed"))},enable:function(){return-1!=b.queryCommandState(i)}})}),e.button({position:"ring",key:"/",action:function(){b.queryCommandState("expand")?b.queryCommandState("collapse")||b.execCommand("collapse"):b.execCommand("expand")},enable:function(){return-1!=b.queryCommandState("expand")||-1!=b.queryCommandState("collapse")},beforeShow:function(){b.queryCommandState("expand")?this.$button.children[0].innerHTML="收起":this.$button.children[0].innerHTML="展开"}})}return c.exports=d}},b[13]={value:function(a,b,c){function d(){var a=this.minder,b=this.hotbox,c=b.state("main");c.button({position:"top",label:"优先级",key:"P",next:"priority"});var d=b.state("priority");"123456789".replace(/./g,function(b){d.button({position:"ring",label:"P"+b,key:b,action:function(){a.execCommand("Priority",b)}})}),d.button({position:"center",label:"移除",key:"Del",action:function(){a.execCommand("Priority",0)}}),d.button({position:"top",label:"返回",key:"esc",next:"back"})}return c.exports=d}},b[14]={value:function(a,b,c){function d(){var a=this.minder,b=this.hotbox,c=b.state("main");c.button({position:"top",label:"进度",key:"G",next:"progress"});var d=b.state("progress");"012345678".replace(/./g,function(b){d.button({position:"ring",label:"G"+b,key:b,action:function(){a.execCommand("Progress",parseInt(b)+1)}})}),d.button({position:"center",label:"移除",key:"Del",action:function(){a.execCommand("Progress",0)}}),d.button({position:"top",label:"返回",key:"esc",next:"back"})}return c.exports=d}},b[15]={value:function(a,c,d){function e(){function a(a){a.is=function(a){for(var b=a.split("|"),c=0;c<b.length;c++)if(f.is(this,b[c]))return!0;return!1};for(var c,d=0;d<g.length;d++)if(c=g[d],("*"==c.notifyState||c.notifyState==b.state())&&c.call(null,a))return}var b=this.fsm,c=this.minder,d=document.createElement("div");d.contentEditable=!0,d.classList.add("receiver"),d.onkeydown=d.onkeypress=d.onkeyup=a,this.container.appendChild(d);var e={element:d,selectAll:function(){d.innerHTML||(d.innerHTML="&nbsp;");var a=document.createRange(),b=window.getSelection();a.selectNodeContents(d),b.removeAllRanges(),b.addRange(a),d.focus()}};e.selectAll(),c.on("beforemousedown",e.selectAll);var g=[];e.listen=function(a,b){1==arguments.length&&(b=a,a="*"),b.notifyState=a,g.push(b)},this.receiver=e}var f=b.r(20);return d.exports=e}},b[16]={value:function(a,c,d){function e(){}function f(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c);return b}function g(a){var b=this.flaged=-1!=window.location.search.indexOf(a);if(b){var c=f(a)%360,d=h("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",c),g="background: none; color: black;";this.log=function(){var b=h.apply(null,arguments);console.log(h("%c{0}%c{1}",a,b),d,g)}}else this.log=e}var h=b.r(17);return d.exports=g}},b[17]={value:function(a,b,c){function d(a,b){return"object"!=typeof b&&(b=[].slice.call(arguments,1)),String(a).replace(/\{(\w+)\}/gi,function(a,c){return b[c]||c})}return c.exports=d}},b[18]={value:function(a,b,c){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",function(){var a,b,c=window.getSelection(),d=[];for(b=0;b<c.rangeCount;b++)d[b]=c.getRangeAt(b);for(c.removeAllRanges(),c.selectAllChildren(this),a=c.toString(),c.removeAllRanges(),b=0;b<d.length;b++)c.addRange(d[b]);return a}),HTMLElement.prototype.__defineSetter__("innerText",function(a){this.innerHTML=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}))}},b[19]={value:function(a,b,c){function d(a){return-1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function e(a){return"object"==typeof a?JSON.parse(JSON.stringify(a)):a}function f(a,b,c,g){for(var i=h(b),j=h(a),k=!1,l=!1,m=j.length-1;m>=0;m--){var n=j[m],o=a[n];if(b.hasOwnProperty(n)){var p=b[n];"object"==typeof o&&null!=o&&"object"==typeof p&&null!=p?f(o,p,c,g+"/"+d(n)):o!=p&&(k=!0,c.push({op:"replace",path:g+"/"+d(n),value:e(p)}))}else c.push({op:"remove",path:g+"/"+d(n)}),l=!0}if(l||i.length!=j.length)for(var m=0;m<i.length;m++){var n=i[m];a.hasOwnProperty(n)||c.push({op:"add",path:g+"/"+d(n),value:e(b[n])})}}function g(a,b){var c=[];return f(a,b,c,""),c}var h=function(){return Object.keys?Object.keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}}();return c.exports=g}},b[20]={value:function(a,c,d){function e(a){return"string"==typeof a?h(a):g(a)}function f(a,b){return a&&b&&e(a)==e(b)}function g(a){var b=0;return(a.ctrlKey||a.metaKey)&&(b|=j),a.altKey&&(b|=k),a.shiftKey&&(b|=l),-1==[16,17,18,91].indexOf(a.keyCode)&&(b|=a.keyCode),b}function h(a){var b=0;return a.toLowerCase().split(/\s*\+\s*/).forEach(function(a){switch(a){case"ctrl":case"cmd":b|=j;break;case"alt":b|=k;break;case"shift":b|=l;break;default:b|=i[a]}}),b}var i=b.r(21),j=4096,k=8192,l=16384;c.hash=e,c.is=f}},b[21]={value:function(a,b,c){var d={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var e in d)d.hasOwnProperty(e)&&(d[e.toLowerCase()]=d[e]);var f=65,g="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(a){d[a]=f+(a.charCodeAt(0)-g)});var h=9;do d[h.toString()]=h+48;while(--h);c.exports=d}};var c={"expose-editor":1};angular.module("kityminderEditor",["ui.bootstrap","ui.codemirror","colorpicker.module"]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self","http://agroup.baidu.com:8910/**","http://agroup.baidu.com:8911/**"])}]),angular.module("kityminderEditor").run(["$templateCache",function(a){"use strict";a.put("ui/directive/colorPanel/colorPanel.html",'<ul class="color-list"><li ng-repeat="c in seriesColor" class="color-wrap" ng-class="{\'color-wrap-selected\': minder.queryCommandValue(\'background\') == c}" ng-disabled="minder.queryCommandState(\'background\') === -1"><span ng-click="minder.execCommand(\'background\', c)" ng-style="{ \'background-color\': c }" class="color-item" title="{{ c }}"></span></li><li class="color-wrap" ng-disabled="minder.queryCommandState(\'background\') === -1" ng-class="{\'color-wrap-selected\': minder.queryCommandValue(\'background\') == customColor}"><span colorpicker class="color-item" ng-model="hexPicker" ng-style="{ \'background-color\': customColor }" title="{{ hexPicker }}"></span></li></ul>'),a.put("ui/directive/controlPanel/controlPanel.html",'<div class="divider"></div><tabset><tab heading="{{ \'idea\' | lang: \'ui/tabs\'; }}"><accordion close-others="false"><accordion-group heading="{{ \'priority\' | lang: \'panels\'; }}" is-open="true"><priority-editor minder="minder"></priority-editor></accordion-group><accordion-group heading="{{ \'progress\' | lang: \'panels\'; }}" is-open="true"><progress-editor minder="minder"></progress-editor></accordion-group><accordion-group heading="{{ \'resource\' | lang: \'panels\'; }}" is-open="true"><resource-editor minder="minder"></resource-editor></accordion-group></accordion></tab><tab heading="{{ \'appearence\' | lang: \'ui/tabs\'; }}"><accordion close-others="false"><accordion-group heading="{{ \'template\' | lang: \'panels\'; }}" is-open="true"><template-list minder="minder" class="inline-directive"></template-list><layout minder="minder" class="inline-directive"></layout></accordion-group></accordion><accordion close-others="false"><accordion-group heading="{{ \'theme\' | lang: \'panels\'; }}" is-open="true"><theme-list minder="minder"></theme-list></accordion-group></accordion><accordion close-others="false"><accordion-group heading="{{ \'style\' | lang: \'panels\'; }}" is-open="true"><style-operator minder="minder" class="inline-directive"></style-operator></accordion-group></accordion><accordion close-others="false"><accordion-group heading="{{ \'font\' | lang: \'panels\'; }}" is-open="true"><font-operator minder="minder" class="inline-directive"></font-operator></accordion-group></accordion><accordion close-others="false"><accordion-group heading="{{ \'background\' | lang: \'panels\'; }}" is-open="true"><color-panel minder="minder" class="inline-directive"></color-panel></accordion-group></accordion></tab><tab heading="{{ \'note\' | lang: \'panels\'; }}" select="refreshNotePanel()"><note-editor minder="minder" class="km-note"></note-editor></tab></tabset>'),a.put("ui/directive/fontOperator/fontOperator.html",'<span class="dropdown font-size-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontsize\') === -1"><a href class="current-font-item" title="{{ \'fontsize\' | lang: \'ui\' }}">{{ minder.queryCommandValue(\'fontsize\') || \'默认字号\' }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontSizeList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontsize\', f)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontsize\') }" ng-style="{\'font-size\': f + \'px\'}">{{ f }}</a></li></ul></span> <span class="s-btn-icon font-bold" ng-click="minder.execCommand(\'bold\')" ng-class="{\'font-bold-selected\' : minder.queryCommandState(\'bold\') == 1}" ng-disabled="minder.queryCommandState(\'bold\') === -1"></span> <span class="s-btn-icon font-italics" ng-click="minder.execCommand(\'italic\')" ng-class="{\'font-italics-selected\' : minder.queryCommandState(\'italic\') == 1}" ng-disabled="minder.queryCommandState(\'italic\') === -1"></span><div class="font-color-wrap"><span colorpicker class="font-color" ng-model="hexPicker" ng-style="{ \'background-color\': customColor }" ng-disabled="minder.queryCommandState(\'forecolor\') === -1" title="{{ hexPicker }}"></span></div>'),a.put("ui/directive/kityminderEditor/kityminderEditor.html",'<div class="minder-editor-container"><div class="minder-editor" ng-style="{\'right\': (config.dividerWidth + config.ctrlPanelWidth) + \'px\' }"></div><div class="minder-divider" minder-divider="config" minder="minder" ng-if="minder" ng-style="{\'width\': config.dividerWidth + \'px\', \'right\': config.ctrlPanelWidth + \'px\'}"></div><div class="control-panel" control-panel ng-if="minder" ng-style="{\'width\': config.ctrlPanelWidth + \'px\'}"></div><div class="note-previewer" note-previewer ng-if="minder"></div></div>'),a.put("ui/directive/layout/layout.html",'<a ng-click="minder.execCommand(\'resetlayout\')" class="btn-wrap" ng-disabled="minder.queryCommandState(\'resetlayout\') === -1"><span class="btn-icon reset-layout-icon"></span> <span class="btn-label">{{ \'resetlayout\' | lang: \'ui/command\' }}</span></a>'),a.put("ui/directive/noteEditor/noteEditor.html",'<div class="km-note" ng-show="noteEnabled" ui-codemirror="{ onLoad: codemirrorLoaded }" ng-model="noteContent" ui-codemirror-opts="{\n		gfm: true,\n		breaks: true,\n		lineWrapping : true,\n		mode: \'gfm\',\n        dragDrop: false,\n        lineNumbers:true\n	 }"></div><p ng-show="!noteEnabled" class="km-note-tips">请选择节点编辑备注</p>'),a.put("ui/directive/notePreviewer/notePreviewer.html",'<div id="previewer-content" ng-show="showNotePreviewer" ng-style="previewerStyle" ng-bind-html="noteContent"></div>'),a.put("ui/directive/priorityEditor/priorityEditor.html",'<ul class="km-priority tool-group" ng-disabled="commandDisabled"><li class="km-priority-item tool-group-item" ng-repeat="p in priorities" ng-click="minder.execCommand(\'priority\', p)" ng-class="{ active: commandValue == p }" title="{{ getPriorityTitle(p) }}"><div class="km-priority-icon tool-group-icon priority-{{p}}"></div></li></ul>'),a.put("ui/directive/progressEditor/progressEditor.html",'<ul class="km-progress tool-group" ng-disabled="commandDisabled"><li class="km-progress-item tool-group-item" ng-repeat="p in progresses" ng-click="minder.execCommand(\'progress\', p)" ng-class="{ active: commandValue == p }" title="{{ getProgressTitle(p) }}"><div class="km-progress-icon tool-group-icon progress-{{p}}"></div></li></ul>'),a.put("ui/directive/resourceEditor/resourceEditor.html",'<div><div class="input-group"><input class="form-control" type="text" ng-model="newResourceName" ng-required ng-keypress="$event.keyCode == 13 && addResource(newResourceName)" ng-disabled="!enabled"> <span class="input-group-btn"><button class="btn btn-default" ng-click="addResource(newResourceName)" ng-disabled="!enabled">添加</button></span></div><ul class="km-resource"><li ng-repeat="resource in used" ng-disabled="!enabled"><label style="background: {{resourceColor(resource.name)}}"><input type="checkbox" ng-model="resource.selected" ng-disabled="!enabled"> <span>{{resource.name}}</span></label></li></ul></div>'),a.put("ui/directive/styleOperator/styleOperator.html",'<a ng-click="minder.execCommand(\'clearstyle\')" class="btn-wrap" ng-disabled="minder.queryCommandState(\'clearstyle\') === -1;"><span class="btn-icon clear-style-icon"></span> <span class="btn-label">{{ \'clearstyle\' | lang: \'ui\' }}</span></a><div class="s-btn-group-vertical"><a class="s-btn-wrap" href ng-click="minder.execCommand(\'copystyle\')" ng-disabled="minder.queryCommandState(\'copystyle\') === -1;"><span class="s-btn-icon copy-style-icon"></span> <span class="s-btn-label">{{ \'copystyle\' | lang: \'ui\' }}</span></a> <a class="s-btn-wrap paste-style-wrap" href ng-click="minder.execCommand(\'pastestyle\')" ng-disabled="minder.queryCommandState(\'pastestyle\') === -1;"><span class="s-btn-icon paste-style-icon"></span> <span class="s-btn-label">{{ \'pastestyle\' | lang: \'ui\' }}</span></a></div>'),a.put("ui/directive/templateList/templateList.html",'<span class="dropdown" dropdown on-toggle="toggled(open)"><div class="dropdown-toggle current-temp-item" ng-disabled="minder.queryCommandState(\'template\') === -1" dropdown-toggle><a href class="temp-item {{ minder.queryCommandValue(\'template\') }}" title="{{ minder.queryCommandValue(\'template\') | lang: \'template\' }}"></a> <span class="caret"></span></div><ul class="dropdown-menu temp-list"><li ng-repeat="(key, templateObj) in templateList" class="temp-item-wrap"><a ng-click="minder.execCommand(\'template\', key);" class="temp-item {{key}}" ng-class="{ \'temp-item-selected\' : key == minder.queryCommandValue(\'template\') }" title="{{ key | lang: \'template\' }}"></a></li></ul></span>'),a.put("ui/directive/themeList/themeList.html",'<span class="dropdown" dropdown><div class="dropdown-toggle theme-item-selected" dropdown-toggle ng-disabled="minder.queryCommandState(\'theme\') === -1"><a href class="theme-item" ng-style="getThemeThumbStyle(minder.queryCommandValue(\'theme\'))" title="{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}">{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}</a> <span class="caret"></span></div><ul class="dropdown-menu theme-list"><li ng-repeat="key in themeKeyList" class="theme-item-wrap"><a ng-click="minder.execCommand(\'theme\', key);" class="theme-item" ng-style="getThemeThumbStyle(key)" title="{{ key | lang: \'theme\'; }}">{{ key | lang: \'theme\'; }}</a></li></ul></span>')}]),angular.module("kityminderEditor").service("commandBinder",function(){return{bind:function(a,b,c){a.on("interactchange",function(){c.commandDisabled=-1===a.queryCommandState(b),c.commandValue=a.queryCommandValue(b),c.$apply()})}}}),angular.module("kityminderEditor").service("config",function(){return{_default:{ctrlPanelMin:250,ctrlPanelWidth:parseInt(window.localStorage.__dev_minder_ctrlPanelWidth)||250,dividerWidth:3,defaultLang:"zh-cn"},getConfig:function(a){return void 0==a?this._default:this._default[a]||null},setConfig:function(a){this._default=a}}}),angular.module("kityminderEditor").service("lang.zh-cn",function(){return{"zh-cn":{template:{"default":"思维导图",tianpan:"天盘图",structure:"组织结构图",filetree:"目录组织图",right:"逻辑结构图","fish-bone":"鱼骨头图"},theme:{classic:"脑图经典","classic-compact":"紧凑经典",snow:"温柔冷光","snow-compact":"紧凑冷光",fish:"鱼骨图",wire:"线框","fresh-red":"清新红","fresh-soil":"泥土黄","fresh-green":"文艺绿","fresh-blue":"天空蓝","fresh-purple":"浪漫紫","fresh-pink":"脑残粉","fresh-red-compat":"紧凑红","fresh-soil-compat":"紧凑黄","fresh-green-compat":"紧凑绿","fresh-blue-compat":"紧凑蓝","fresh-purple-compat":"紧凑紫","fresh-pink-compat":"紧凑粉",tianpan:"经典天盘","tianpan-compact":"紧凑天盘"},maintopic:"中心主题",topic:"分支主题",panels:{history:"历史",template:"模板",theme:"皮肤",layout:"布局",style:"样式",font:"文字",color:"颜色",background:"背景",insert:"插入",arrange:"调整",nodeop:"当前",priority:"优先级",progress:"进度",resource:"资源",note:"备注",attachment:"附件",word:"文字"},error_message:{title:"哎呀，脑图出错了",err_load:"加载脑图失败",err_save:"保存脑图失败",err_network:"网络错误",err_doc_resolve:"文档解析失败",err_unknown:"发生了奇怪的错误",err_localfile_read:"文件读取错误",err_download:"文件下载失败",err_remove_share:"取消分享失败",err_create_share:"分享失败",err_mkdir:"目录创建失败",err_ls:"读取目录失败",err_share_data:"加载分享内容出错",err_share_sync_fail:"分享内容同步失败",err_move_file:"文件移动失败",err_rename:"重命名失败",unknownreason:"可能是外星人篡改了代码...",pcs_code:{3:"不支持此接口",4:"没有权限执行此操作",5:"IP未授权",110:"用户会话已过期，请重新登录",31001:"数据库查询错误",31002:"数据库连接错误",31003:"数据库返回空结果",31021:"网络错误",31022:"暂时无法连接服务器",31023:"输入参数错误",31024:"app id为空",31025:"后端存储错误",31041:"用户的cookie不是合法的百度cookie",31042:"用户未登陆",31043:"用户未激活",31044:"用户未授权",31045:"用户不存在",31046:"用户已经存在",31061:"文件已经存在",31062:"文件名非法",31063:"文件父目录不存在",31064:"无权访问此文件",31065:"目录已满",31066:"文件不存在",31067:"文件处理出错",31068:"文件创建失败",31069:"文件拷贝失败",31070:"文件删除失败",31071:"不能读取文件元信息",31072:"文件移动失败",31073:"文件重命名失败",31079:"未找到文件MD5，请使用上传API上传整个文件。",31081:"superfile创建失败",31082:"superfile 块列表为空",31083:"superfile 更新失败",31101:"tag系统内部错误",31102:"tag参数错误",31103:"tag系统错误",31110:"未授权设置此目录配额",31111:"配额管理只支持两级目录",31112:"超出配额",31113:"配额不能超出目录祖先的配额",31114:"配额不能比子目录配额小",31141:"请求缩略图服务失败",31201:"签名错误",31202:"文件不存在",31203:"设置acl失败",31204:"请求acl验证失败",31205:"获取acl失败",31206:"acl不存在",31207:"bucket已存在",31208:"用户请求错误",31209:"服务器错误",31210:"服务器不支持",31211:"禁止访问",31212:"服务不可用",31213:"重试出错",31214:"上传文件data失败",31215:"上传文件meta失败",31216:"下载文件data失败",31217:"下载文件meta失败",31218:"容量超出限额",31219:"请求数超出限额",31220:"流量超出限额",31298:"服务器返回值KEY非法",31299:"服务器返回值KEY不存在"}},ui:{shared_file_title:"[分享的] {0} (只读)",load_share_for_edit:"正在加载分享的文件...",share_sync_success:"分享内容已同步",recycle_clear_confirm:"确认清空回收站么？清空后的文件无法恢复。",fullscreen_exit_hint:"按 Esc 或 F11 退出全屏",error_detail:"详细信息",copy_and_feedback:"复制并反馈",move_file_confirm:'确定把 "{0}" 移动到 "{1}" 吗？',rename:"重命名",rename_success:"{0} 重命名成功",move_success:"{0} 移动成功到 {1}",command:{appendsiblingnode:"插入同级主题",appendchildnode:"插入下级主题",removenode:"删除",editnode:"编辑",arrangeup:"上移",arrangedown:"下移",resetlayout:"整理布局",expandtoleaf:"展开全部节点",expandtolevel1:"展开到一级节点",expandtolevel2:"展开到二级节点",expandtolevel3:"展开到三级节点",expandtolevel4:"展开到四级节点",expandtolevel5:"展开到五级节点",expandtolevel6:"展开到六级节点",fullscreen:"全屏",outline:"大纲"},expandtoleaf:"展开",back:"返回",undo:"撤销 (Ctrl + Z)",redo:"重做 (Ctrl + Y)",tabs:{idea:"思路",appearence:"外观",view:"视图"},quickvisit:{"new":"新建 (Ctrl + Alt + N)",save:"保存 (Ctrl + S)",share:"分享 (Ctrl + Alt + S)",feedback:"反馈问题（F1）",editshare:"编辑"},menu:{mainmenutext:"百度脑图",newtab:"新建",opentab:"打开",savetab:"保存",sharetab:"分享",preferencetab:"设置",helptab:"帮助",feedbacktab:"反馈",recenttab:"最近使用",netdisktab:"百度云存储",localtab:"本地文件",drafttab:"草稿箱",downloadtab:"导出到本地",createsharetab:"当前脑图",managesharetab:"已分享",newheader:"新建脑图",openheader:"打开",saveheader:"保存到",draftheader:"草稿箱",shareheader:"分享我的脑图",downloadheader:"导出到指定格式",preferenceheader:"偏好设置",helpheader:"帮助",feedbackheader:"反馈"},mydocument:"我的文档",emptydir:"目录为空！",pickfile:"选择文件...",acceptfile:"支持的格式：{0}",dropfile:"或将文件拖至此处",unsupportedfile:"不支持的文件格式",untitleddoc:"未命名文档",overrideconfirm:"{0} 已存在，确认覆盖吗？",checklogin:"检查登录状态中...",loggingin:"正在登录...",recent:"最近打开",clearrecent:"清空",clearrecentconfirm:"确认清空最近文档列表？",cleardraft:"清空",cleardraftconfirm:"确认清空草稿箱？",none_share:"不分享",public_share:"公开分享",password_share:"私密分享",email_share:"邮件邀请",url_share:"脑图 URL 地址：",sns_share:"社交网络分享：",sns_share_text:"“{0}” - 我用百度脑图制作的思维导图，快看看吧！（地址：{1}）",none_share_description:"不分享当前脑图",public_share_description:"创建任何人可见的分享",share_button_text:"创建",password_share_description:"创建需要密码才可见的分享",email_share_description:"创建指定人可见的分享，您还可以允许他们编辑",ondev:"敬请期待！",create_share_failed:"分享失败：{0}",remove_share_failed:"删除失败：{1}",copy:"复制",copied:"已复制",shared_tip:"当前脑图被 {0}  分享，你可以修改之后保存到自己的网盘上或再次分享",current_share:"当前脑图",manage_share:"我的分享",share_remove_action:"不分享该脑图",share_view_action:"打开分享地址",share_edit_action:"编辑分享的文件",login:"登录",logout:"注销",switchuser:"切换账户",userinfo:"个人信息",gotonetdisk:"我的网盘",requirelogin:'请 <a class="login-button">登录</a> 后使用',saveas:"保存为",filename:"文件名",fileformat:"保存格式",save:"保存",mkdir:"新建目录",recycle:"回收站",newdir:"未命名目录",bold:"加粗",italic:"斜体",forecolor:"字体颜色",fontfamily:"字体",fontsize:"字号",layoutstyle:"主题",node:"节点操作",saveto:"另存为",hand:"允许拖拽",camera:"定位根节点","zoom-in":"放大（Ctrl+）","zoom-out":"缩小（Ctrl-）",markers:"标签",resource:"资源",help:"帮助",preference:"偏好设置",expandnode:"展开到叶子",collapsenode:"收起到一级节点",template:"模板",theme:"皮肤",clearstyle:"清除样式",copystyle:"复制样式",pastestyle:"粘贴样式",appendsiblingnode:"同级主题",appendchildnode:"下级主题",arrangeup:"前调",arrangedown:"后调",editnode:"编辑",removenode:"移除",priority:"优先级",progress:{p1:"未开始",p2:"完成 1/8",p3:"完成 1/4",p4:"完成 3/8",p5:"完成一半",p6:"完成 5/8",p7:"完成 3/4",p8:"完成 7/8",p9:"已完成",p0:"清除进度"},link:"链接",image:"图片",note:"备注",removelink:"移除已有连接",removeimage:"移除已有图片",removenote:"移除已有备注",resetlayout:"整理",justnow:"刚刚",minutesago:"{0} 分钟前",hoursago:"{0} 小时前",yesterday:"昨天",daysago:"{0} 天前",longago:"很久之前",redirect:"您正在打开连接 {0}，百度脑图不能保证连接的安全性，是否要继续？",navigator:"导航器",unsavedcontent:"当前文件还没有保存到网盘：\n\n{0}\n\n虽然未保存的数据会缓存在草稿箱，但是清除浏览器缓存会导致草稿箱清除。",shortcuts:"快捷键",contact:"联系与反馈",email:"邮件组",qq_group:"QQ 群",github_issue:"Github",baidu_tieba:"贴吧",clipboardunsupported:"您的浏览器不支持剪贴板，请使用快捷键复制",load_success:"{0} 加载成功",save_success:"{0} 已保存于 {1}",autosave_success:"{0} 已自动保存于 {1}",selectall:"全选",selectrevert:"反选",selectsiblings:"选择兄弟节点",selectlevel:"选择同级节点",selectpath:"选择路径",selecttree:"选择子树"},popupcolor:{clearColor:"清空颜色",standardColor:"标准颜色",themeColor:"主题颜色"},dialogs:{markers:{"static":{lang_input_text:"文本内容：",lang_input_url:"链接地址：",lang_input_title:"标题：",lang_input_target:"是否在新窗口："},priority:"优先级",none:"无",progress:{title:"进度",notdone:"未完成",done1:"完成 1/8",done2:"完成 1/4",done3:"完成 3/8",done4:"完成 1/2",done5:"完成 5/8",done6:"完成 3/4",done7:"完成 7/8",done:"已完成"}},help:{},hyperlink:{},image:{},resource:{}},hyperlink:{hyperlink:"链接...",unhyperlink:"移除链接"},image:{image:"图片...",removeimage:"移除图片"},marker:{marker:"进度/优先级..."},resource:{resource:"资源..."}}}}),angular.module("kityminderEditor").filter("commandState",function(){return function(a,b){return a.queryCommandState(b)}}).filter("commandValue",function(){return function(a,b){return a.queryCommandValue(b)}}),angular.module("kityminderEditor").filter("lang",["config","lang.zh-cn",function(a,b){return function(c,d){var e=a.getConfig("defaultLang");if(void 0==b[e])return"未发现对应语言包，请检查 lang.xxx.service.js!";var f=b[e];return d.split("/").forEach(function(a,b){f=f[a]}),f[c]||null}}]),angular.module("kityminderEditor").directive("colorPanel",function(){return{restrict:"E",templateUrl:"ui/directive/colorPanel/colorPanel.html",scope:{minder:"="},link:function(a){var b=a.minder,c=b.getThemeItems();a.hexPicker=a.hexPicker||c.background,a.seriesColor=["#e75d66","#fac75b","#99ca6a","#00c5ad","#3bbce0","#425b71","#ffffff"],a.$on("colorpicker-selected",function(c,d){b.execCommand("background",d.value),a.customColor=d.value}),b.on("interactchange",function(){var c=b.queryCommandValue("background")||"#000000";a.customColor=-1==a.seriesColor.indexOf(c)?c:null})}}}),angular.module("kityminderEditor").directive("controlPanel",function(){return{templateUrl:"ui/directive/controlPanel/controlPanel.html",restrict:"A",link:function(a){a.refreshNotePanel=function(){a.$broadcast("notePanelActived")}}}}),angular.module("kityminderEditor").directive("fontOperator",function(){return{restrict:"E",templateUrl:"ui/directive/fontOperator/fontOperator.html",scope:{minder:"="},link:function(a){var b=a.minder,c=b.getThemeItems();a.hexPicker=a.hexPicker||c["main-color"],a.fontSizeList=[10,12,16,18,24,32,48],a.$on("colorpicker-selected",function(c,d){b.execCommand("forecolor",d.value),a.customColor=d.value}),b.on("interactchange",function(){a.customColor=b.queryCommandValue("forecolor")||"#000000"})}}}),angular.module("kityminderEditor").directive("kityminderEditor",["config",function(a){return{restrict:"EA",templateUrl:"ui/directive/kityminderEditor/kityminderEditor.html",
replace:!0,scope:{onInit:"&"},link:function(b,c,d){function e(a,c){b.onInit({editor:a,minder:c})}var f=c.children(".minder-editor")[0];if("undefined"!=typeof seajs)seajs.config({base:"./src"}),define("demo",function(a){var c=a("editor"),d=window.editor=new c(f);window.localStorage.__dev_minder_content&&d.minder.importJson(JSON.parse(window.localStorage.__dev_minder_content)),d.minder.on("contentchange",function(){window.localStorage.__dev_minder_content=JSON.stringify(d.minder.exportJson())}),window.minder=window.km=d.minder,b.editor=d,b.minder=minder,b.$apply(),e(d,minder)}),seajs.use("demo");else if(window.kityminder&&window.kityminder.Editor){var g=new kityminder.Editor(f);window.editor=b.editor=g,window.minder=b.minder=g.minder,e(g,g.minder)}b.config=a.getConfig()}}}]),angular.module("kityminderEditor").directive("layout",function(){return{restrict:"E",templateUrl:"ui/directive/layout/layout.html",scope:{minder:"="},link:function(a){}}}),angular.module("kityminderEditor").directive("minderDivider",["config",function(a){return{scope:{config:"=minderDivider",minder:"="},link:function(b,c){var d,e,f=b.minder,g=a.getConfig("ctrlPanelMin"),h=a.getConfig("dividerWidth"),i=!1,j=document.body.clientWidth,k=b.config.ctrlPanelWidth;c.on("mousedown",function(a){d=a.pageX,i=!0}),$("body").on("mousemove",function(a){if(i){e=a.clientX;var c=d-e,l=j-k,m=g+h-k;c=c>l?l:c,c=m>c?m:c,b.config.ctrlPanelWidth=k+c,b.$apply(),f.fire("resize")}}),window.addEventListener("mouseup",function(a){k=b.config.ctrlPanelWidth,window.localStorage.__dev_minder_ctrlPanelWidth=k,i=!1,b.$apply()})}}}]),angular.module("kityminderEditor").directive("noteEditor",function(){return{restrict:"E",templateUrl:"ui/directive/noteEditor/noteEditor.html",scope:{minder:"="},controller:["$scope",function(a){function b(){var b=a.noteEnabled=-1!=d.queryCommandState("note"),c=d.queryCommandValue("note")||"";b&&(a.noteContent=c),e=!0,a.$apply(),e=!1}var c,d=a.minder,e=!1;a.codemirrorLoaded=function(b){c=a.cmEditor=b,b.setSize("100%","100%")},a.$watch("noteContent",function(a){var b=-1!=d.queryCommandState("note");a&&b&&!e&&d.execCommand("note",a),setTimeout(function(){c.refresh()})}),a.$on("notePanelActived",function(){setTimeout(function(){c.refresh(),c.focus()})}),d.on("interactchange",b)}]}}),angular.module("kityminderEditor").directive("notePreviewer",["$sce",function(a){return{restrict:"A",templateUrl:"ui/directive/notePreviewer/notePreviewer.html",link:function(b,c){function d(c,d){var e=c.getRenderer("NoteIconRenderer").getRenderShape(),h=e.getRenderBox("screen"),j=c.getData("note");g[0].scrollTop=0;var k=marked(j);d&&(k=k.replace(new RegExp("("+d+")","ig"),'<span class="highlight">$1</span>')),b.noteContent=a.trustAsHtml(k),b.$apply();var l=$(f[0]).width(),m=$(f[0]).height(),n=$(g).outerWidth(),o=$(g).outerHeight(),p=h.cx-n/2-f[0].offsetLeft,q=h.bottom+10-f[0].offsetTop;0>p&&(p=10),p+n>l&&(p=h.left-n-10-f[0].offsetLeft),q+o>m&&(q=h.top-o-10-f[0].offsetTop),b.previewerStyle={left:Math.round(p)+"px",top:Math.round(q)+"px"},b.showNotePreviewer=!0;var r=g[0].querySelector(".highlight");r&&r.scrollIntoView(),i=!0,b.$apply()}var e=b.minder,f=c.parent(),g=c.children();b.showNotePreviewer=!1,marked.setOptions({gfm:!0,breaks:!0});var h;e.on("shownoterequest",function(a){h=setTimeout(function(){d(a.node)},300)}),e.on("hidenoterequest",function(){clearTimeout(h)});var i=!1;$(document).on("mousedown mousewheel DOMMouseScroll",function(){i&&(b.showNotePreviewer=!1,b.$apply())}),c.on("mousedown mousewheel DOMMouseScroll",function(a){a.stopPropagation()})}}}]),angular.module("kityminderEditor").directive("priorityEditor",["commandBinder",function(a){return{restrict:"E",templateUrl:"ui/directive/priorityEditor/priorityEditor.html",scope:{minder:"="},link:function(b){for(var c=b.minder,d=[],e=0;10>e;e++)d.push(e);a.bind(c,"priority",b),b.priorities=d,b.getPriorityTitle=function(a){switch(a){case 0:return"移除优先级";default:return"优先级"+a}}}}}]),angular.module("kityminderEditor").directive("progressEditor",["commandBinder",function(a){return{restrict:"E",templateUrl:"ui/directive/progressEditor/progressEditor.html",scope:{minder:"="},link:function(b){for(var c=b.minder,d=[],e=0;10>e;e++)d.push(e);a.bind(c,"progress",b),b.progresses=d,b.getProgressTitle=function(a){switch(a){case 0:return"移除进度";case 1:return"未开始";case 9:return"全部完成";default:return"完成"+(a-1)+"/8"}}}}}]),angular.module("kityminderEditor").directive("resourceEditor",function(){return{restrict:"E",templateUrl:"ui/directive/resourceEditor/resourceEditor.html",scope:{minder:"="},controller:["$scope",function(a){var b=a.minder,c=!1;b.on("interactchange",function(){var d=a.enabled=-1!=b.queryCommandState("resource"),e=d?b.queryCommandValue("resource"):[],f=b.getUsedResource().map(function(a){return{name:a,selected:e.indexOf(a)>-1}});a.used=f,c=!0,a.$apply(),c=!1}),a.$watch("used",function(a){if(-1!=b.queryCommandState("resource")&&a){var d=a.filter(function(a){return a.selected}).map(function(a){return a.name});if(c)return;b.execCommand("resource",d)}},!0),a.resourceColor=function(a){return b.getResourceColor(a).toHEX()},a.addResource=function(c){var d=b.queryCommandValue("resource");c&&/\S/.test(c)&&(-1==d.indexOf(c)&&a.used.push({name:c,selected:!0}),a.newResourceName=null)}}]}}),angular.module("kityminderEditor").directive("styleOperator",function(){return{restrict:"E",templateUrl:"ui/directive/styleOperator/styleOperator.html",scope:{minder:"="}}}),angular.module("kityminderEditor").directive("templateList",function(){return{restrict:"E",templateUrl:"ui/directive/templateList/templateList.html",scope:{minder:"="},link:function(a){a.templateList=kityminder.Minder.getTemplateList()}}}),angular.module("kityminderEditor").directive("themeList",function(){return{restrict:"E",templateUrl:"ui/directive/themeList/themeList.html",link:function(a){var b=kityminder.Minder.getThemeList();a.getThemeThumbStyle=function(a){var c=b[a];if(c){var d={color:c["root-color"],"border-radius":c["root-radius"]/2};return c["root-background"]&&(d.background=c["root-background"].toString()),d}},a.themeKeyList=["classic","classic-compact","fresh-blue","fresh-blue-compat","fresh-green","fresh-green-compat","fresh-pink","fresh-pink-compat","fresh-purple","fresh-purple-compat","fresh-red","fresh-red-compat","fresh-soil","fresh-soil-compat","snow","snow-compact","fish","wire"]}}}),a("expose-editor")}();